<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Group Unsubscribe</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 32px auto; line-height: 1.5; color: #111; }
    .card { border: 1px solid #e0e0e0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
    h1 { margin-top: 0; }
    #unsubscribe-groups { margin-top: 12px; }
    .group-row { display:flex; align-items:center; gap:8px; margin:6px 0; }
    button { padding:8px 14px; border-radius:6px; border:1px solid #bbb; background:#0b73ff; color:white; cursor:pointer; }
    input#email { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Email Subscription Preferences</h1>

    <div>
      <h4>I want to unsubscribe from future emails</h4>
      <input type="text" id="email" readonly="readonly" placeholder="Loading email..." />
      <div id="unsubscribe-groups" style="display:none"></div>

      <div style="margin-top:16px;">
        <button onclick="changeSubscriptionGroups()">Update Subscription Groups</button>
      </div>
    </div>
  </div>

  <!-- CleverTap SDK -->
  <script type="text/javascript">
    var clevertap = {event:[], profile:[], region : 'eu1', account:[], onUserLogin:[], notifications:[], privacy:[]};
    clevertap.account.push({"id": "TEST-4W5-9RR-646Z"});
    (function () {
      var wzrk = document.createElement('script');
      wzrk.type = 'text/javascript';
      wzrk.async = true;
      wzrk.src = 'https://d2r1yp2w7bby2u.cloudfront.net/js/clevertap.min.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(wzrk, s);
    })();
  </script>

  <script>
    var isReEncode = false;
    var withGroups = true;

    window.onload = function() {
      if (typeof $WZRK_WR !== 'undefined') {
        $WZRK_WR.getEmail(isReEncode, withGroups);
      }
    };

    function wzrk_email_fetched(emailStr, profile) {
      document.getElementById('email').value = emailStr || '';

      if (!profile || !profile.groups || !Array.isArray(profile.groups)) {
        return;
      }

      $WZRK_WR.setSubscriptionGroups(profile.groups);
      displayGroups();
    }

    function displayGroups() {
      var addList = document.getElementById('unsubscribe-groups');
      addList.innerHTML = '';

      var subscriptionGroups = $WZRK_WR.getSubscriptionGroups();
      if (!subscriptionGroups || subscriptionGroups.length === 0) {
        addList.style.display = 'none';
        return;
      }

      addList.style.display = 'block';

      subscriptionGroups.forEach(function (obj, idx) {
        var row = document.createElement('div');
        row.className = 'group-row';

        var checkBox = document.createElement('input');
        checkBox.type = 'checkbox';
        checkBox.checked = !!obj.isUnsubscribed;
        checkBox.name = obj.name || ('group_' + idx);
        checkBox.id = 'group_' + idx;
        checkBox.className = "ct-unsub-group-input-item";

        var label = document.createElement('label');
        label.setAttribute("for", checkBox.id);
        label.textContent = "Unsubscribe from " + obj.name;

        row.appendChild(checkBox);
        row.appendChild(label);
        addList.appendChild(row);
      });
    }

    function changeSubscriptionGroups() {
      var updated = [];
      var elements = document.getElementsByClassName("ct-unsub-group-input-item");

      for (var i = 0; i < elements.length; i++) {
        var el = elements[i];
        updated.push({
          name: el.name,
          isUnsubscribed: el.checked
        });
      }

      $WZRK_WR.changeSubscriptionGroups(isReEncode, updated);
    }

    function wzrk_email_subscription(status) {
      alert(status == 0 ? "You've been unsubscribed" : "You've been subscribed");
      $WZRK_WR.getEmail(isReEncode, withGroups);
    }
  </script>
</body>
</html>
