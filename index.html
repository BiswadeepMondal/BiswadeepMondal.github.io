<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clevertap 11234</title>

    <script type="text/javascript">
      var clevertap = {
        event: [],
        profile: [],
        account: [],
        onUserLogin: [],
        notifications: [],
        privacy: [],
      };

      clevertap.account.push({ id: "TEST-4W5-9RR-646Z" });
      clevertap.privacy.push({ optOut: false });

      (function () {
        var wzrk = document.createElement("script");
        wzrk.type = "text/javascript";
        wzrk.async = true;
        wzrk.src =
          ("https:" == document.location.protocol
            ? "https://d2r1yp2w7bby2u.cloudfront.net"
            : "http://static.clevertap.com") + "/js/clevertap.min.js";

        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(wzrk, s);
      })();
    </script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-analytics.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA_Ogl_uvT3_b9isNPxr1QtwVYJ-CL0E3s",
        authDomain: "ctest2-4f342.firebaseapp.com",
        projectId: "ctest2-4f342",
        storageBucket: "ctest2-4f342",
        messagingSenderId: "68868130286",
        appId: "1:68868130286:web:13f41cf53427ffbb84faff",
        measurementId: "G-FGG4RYW3JL",
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
    </script>

    <link rel="manifest" href="/manifest.json" />

    <style>
      #ctinboxdiv {
        position: absolute;
        top: 50px;
        right: 50px;
        cursor: pointer;
      }

      #ctinboxdiv img {
        width: 30px;
        height: 30px;
      }

      button {
        margin-bottom: 10px;
        padding: 8px 14px;
      }
    </style>
  </head>

  <body>
    <div id="inbox">
      <img
        src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS1xE3E2-aqM6p-gIyfTuRX3K-ZTaORndcmYA&s"
        alt="Bell Icon"
      />
    </div>

    <h1>Web SDK Integration Test 4</h1>

    <button id="event" onclick="pushEvent()">Push Event</button> <br />
    <button id="login" onclick="manualOnUserLogin()">OnUserLogin</button><br />
    <button id="ipfalse" onclick="ipfalse()">IP FALSE</button><br />
    <button id="iptrue" onclick="iptrue()">IP TRUE</button><br />
    <button id="profile" onclick="profilepush()">ProfilePush</button><br />
    <button id="loc" onclick="pushnotif()">Send Notification</button><br />
    <button id="ctid" onclick="showctid()">Show CT ID</button><br />

    <!-- ⭐ NEW SIGN-UP BUTTON -->
    <button onclick="goToSignup()">Go to Sign Up Page</button><br />

    <h2 id="test"></h2>

    <script>


  let showctid = async () => {
    const identity = prompt("Enter Identity (example: krishna123):");

    if (!identity || identity.trim() === "") {
      alert("Identity cannot be empty");
      return;
    }

    const proxyUrl = "https://script.google.com/macros/s/AKfycbwDGfR7daChv1_K0Em09KN43fInWUpd2OetLPn2X2TRWRjBpHBATYqVKgML5ZuhRoqz/exec";

    try {
      const res = await fetch(`${proxyUrl}?identity=${encodeURIComponent(identity)}`);
      const data = await res.json();

      console.log("Wallet Response:", data);
      alert(JSON.stringify(data, null, 2));
    } catch (e) {
      console.error(e);
      alert("Error fetching wallet data");
    }
  };


      
      let pushEvent = () => {
        clevertap.event.push("page load");
      };

      let ipfalse = () => {
        clevertap.privacy.push({ useIP: false });
        clevertap.event.push("useIP: false ");
      };

      let iptrue = () => {
        clevertap.privacy.push({ useIP: true });
        clevertap.event.push("useIP: true ");
      };

      function manualOnUserLogin() {
        clevertap.onUserLogin.push({
          Site: {
            Email: "73737373@gmail.com",
          },
        });

        clevertap.event.push("Manual OnUserLogin Triggered");
      }

      let showctid = () => {
        var ctid = clevertap.getCleverTapID();
        document.getElementById("test").innerHTML = ctid;
      };

      // ⭐ SIGN-UP REDIRECT FUNCTION
      function goToSignup() {
        window.location.href =
          "https://biswadeepmondal.github.io/login.html";
      }
    </script>

    <script>
      let pushnotif = () => {
        clevertap.notifications.push({
          titleText: "Would you like to receive Notification?",
          bodyText:
            "Will send you only trusted notifications and updates",
          okButtonText: "OK",
          rejectButtonText: "Cancel",
          okButtonColor: "#F28046",
        });
      };
    </script>

    <!-- ⭐ AUTO LOGIN USING URL PARAM -->
    <script>
      function getUrlEmail() {
        const params = new URLSearchParams(window.location.search);
        return params.get("email");
      }

      function autoLoginIfEmailPresent() {
        const email = getUrlEmail();

        if (email && email.trim() !== "") {
          console.log("Auto Login Triggered with email:", email);

          clevertap.onUserLogin.push({
            Site: {
              Email: email,
            },
          });

          clevertap.event.push("Auto User Login Triggered");
        }
      }

      window.onload = autoLoginIfEmailPresent;
    </script>
  </body>
</html>
